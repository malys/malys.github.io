<!DOCTYPE html>
<html>
  <head>
    <title>Redirection de port en SSH</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    
    <link rel="apple-touch-icon" sizes="57x57" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-57x57.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="60x60" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-60x60.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="72x72" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-72x72.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="76x76" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-76x76.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="114x114" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-114x114.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="120x120" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-120x120.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="144x144" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-144x144.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="152x152" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-152x152.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="apple-touch-icon" sizes="180x180" href="//malys.github.io/themes/uno-zen/assets/img/apple-touch-icon-180x180.png?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="icon" type="image/png" href="//malys.github.io/themes/uno-zen/assets/img/favicon-32x32.png?v=wAAv6Wqe6l?v=1468781562223" sizes="32x32">
    <link rel="icon" type="image/png" href="//malys.github.io/themes/uno-zen/assets/img/favicon-194x194.png?v=wAAv6Wqe6l?v=1468781562223" sizes="194x194">
    <link rel="icon" type="image/png" href="//malys.github.io/themes/uno-zen/assets/img/favicon-96x96.png?v=wAAv6Wqe6l?v=1468781562223" sizes="96x96">
    <link rel="icon" type="image/png" href="//malys.github.io/themes/uno-zen/assets/img/android-chrome-192x192.png?v=wAAv6Wqe6l?v=1468781562223" sizes="192x192">
    <link rel="icon" type="image/png" href="//malys.github.io/themes/uno-zen/assets/img/favicon-16x16.png?v=wAAv6Wqe6l?v=1468781562223" sizes="16x16">
    <link rel="manifest" href="//malys.github.io/themes/uno-zen/assets/img/manifest.json?v=wAAv6Wqe6l?v=1468781562223">
    <link rel="shortcut icon" href="//malys.github.io/themes/uno-zen/assets/img/favicon.ico?v=wAAv6Wqe6l?v=1468781562223">
    <meta name="msapplication-TileColor" content="#e74c3c">
    <meta name="msapplication-TileImage" content="//malys.github.io/themes/uno-zen/assets/img/mstile-144x144.png?v=wAAv6Wqe6l?v=1468781562223">
    <meta name="msapplication-config" content="//malys.github.io/themes/uno-zen/assets/img/browserconfig.xml?v=wAAv6Wqe6l?v=1468781562223">
    <meta name="theme-color" content="#e74c3c">
    <link rel="stylesheet" type="text/css" href="//malys.github.io/themes/uno-zen/assets/css/uno-zen.css?v=1468781562223" />
    <link rel="canonical" href="https://malys.github.io/2014/08/05/Redirection-de-port-en-SSH.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Des outils et des développeurs..." />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Redirection de port en SSH" />
    <meta property="og:description" content="Définition La redirection de port ou port forwarding ou port mapping en anglais, consiste à rediriger des paquets réseaux reçus sur un port donné d&amp;#8217;un ordinateur ou un équipement réseau vers un autre ordinateur ou équipement réseau sur un port donné. Cela permet entre autres de proposer à" />
    <meta property="og:url" content="https://malys.github.io/2014/08/05/Redirection-de-port-en-SSH.html" />
    <meta property="article:tag" content="SSH" />
    <meta property="article:tag" content="ProxMox" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Redirection de port en SSH" />
    <meta name="twitter:description" content="Définition La redirection de port ou port forwarding ou port mapping en anglais, consiste à rediriger des paquets réseaux reçus sur un port donné d&amp;#8217;un ordinateur ou un équipement réseau vers un autre ordinateur ou équipement réseau sur un port donné. Cela permet entre autres de proposer à" />
    <meta name="twitter:url" content="https://malys.github.io/2014/08/05/Redirection-de-port-en-SSH.html" />
    
    <script type="application/ld+json">
null
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Des outils et des développeurs..." href="https://malys.github.io/rss/" />
  </head>
  <body class="post-template tag-SSH tag-Prox-Mox">
    <header id="menu-button" class="expanded">
      <a><i class="icon icon-list"></i></a>
    </header>
    <aside class="cover" style="background: url(http://www.knowledge4innovation.eu/sites/default/files/Eco-Innovation.jpeg) center/cover no-repeat fixed">
      <div class="cover container">
        <div class="profile">
          <a id="avatar-link" title="link to homepage for Des outils et des développeurs..." href="https://malys.github.io/#open">
            <img src="https://www.gravatar.com/avatar/c738c1bff9731c9cf6dccd5cc1270e94.png" alt="Des outils et des développeurs... avatar" class="profile avatar rounded hvr-buzz-out" />
            <h1 id="profile-title">Des outils et des développeurs...</h1>
            <h3 id="profile-resume"></h3>
          </a>
    
          <hr class="divider long" />
          <p>Astuces et conseils concernant les outils qui peuvent égailler le quotidien d&#x27;un développeur :)
    
    </p>
          <hr class="divider short" />
          <div class="navigation">
            <div class="profile contact">
              
              <nav class="navigation right">
                <ul class="social expanded">
              
              
              
              
                  <!-- Github -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://github.com/malys/" title="Github account">
                      <i class='icon icon-social-github'></i>
                      <span class="label">Github</span>
                    </a>
                  </li>
                  </li>
              
              
              
              
              
                  <!-- Email -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="mailto:malys@mageos.com" title="Email malys@mageos.com">
                      <i class='icon icon-mail'></i>
                      <span class="label">Email</span>
                    </a>
                  </li>
              
                </ul>
              </nav>
              <!-- <section class="icon icon-search" id="search-container">
      <hr class="divider short" />
      <form id="search-form">
        <input type="text", name="search", placeholder="git, css, javascript,..." id="search-field" />
      </form>
    </section>
     -->
            </div>
          </div>
        </div>
      </div>
    </aside>
    <main>
      <section id="search-results"></section>
      <section class="content">
        

  <article class="post tag-SSH tag-Prox-Mox">
    <header>
      <div class="post meta">
        <time datetime="05 Aug 2014">05 Aug 2014</time>
        <span class="post tags">in <a href="https://malys.github.io/tag/SSH/">SSH</a> <a href="https://malys.github.io/tag/Prox-Mox/">ProxMox</a></span>


        <span class="post reading-time"> ~ <span></span> read.</span>
      </div>
      <a alt="Tweet 'Redirection de port en SSH'" href="https://twitter.com/intent/tweet?text=Redirection%20de%20port%20en%20SSH%20%C2%BB&amp;hashtags=SSH,ProxMox&amp;url=https://malys.github.io/">
        
        <h1 class="icon-reverse icon-social-twitter-post" id="post-title">Redirection de port en SSH</h1>
      </a>
    </header>

    <div id="post-content" class="post tag-SSH tag-Prox-Mox">
      <div class="sect1">
<h2 id="_d_finition">Définition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La redirection de port ou port forwarding ou port mapping en anglais, consiste à rediriger des paquets réseaux reçus sur un port donné d&#8217;un ordinateur ou un équipement réseau vers un autre ordinateur ou équipement réseau sur un port donné. Cela permet entre autres de proposer à des ordinateurs extérieurs à un réseau d&#8217;accéder à des services répartis sur plusieurs ordinateurs de ce réseau. Voir <a href="http://fr.wikipedia.org/wiki/Redirection_de_port">Wikipedia</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_objectif">Objectif</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous souhaitons via une connexion SSH comsommer des services hébergées en local et des services locaux à distance</p>
</div>
<div class="paragraph">
<p>Dans notre cas, nous aurons un serveur Proxmox qui mettra à disposition des containers ou des machines virtuelles.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/portforwarding.png" alt="portforwarding.png"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redirection_de_port">Redirection de port</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_putty">Putty</h4>
<div class="paragraph">
<p>Dans ce cas, nous voulons avoir accès au port 80 de la VM sous CentOS avec le serveur web.</p>
</div>
<div class="paragraph">
<p>Pour cela, nous devons créer un tunnel SSH. Dans notre cas, nous utiliserons Putty comme client SSH (les commandes ssh sous Windows ou Linux sont quasiment identiques).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty1.png" alt="img"></span></p>
</div>
<div class="paragraph">
<p>et configurer le tunnel dans SSH/Tunnels</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty2.png" alt="img"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Source Port : le port local à votre poste sur lequel le service web distant sera accessible

Destination: IP Locale de la VM:Port à rediriger

Local: Permet de définir le sens de la redirection du port dans ce cas là distant -&gt; local</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il faut sauvegarder la configuration.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty3.png" alt="img"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_ligne_de_commande">Ligne de commande</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">plink.exe -ssh proxmoxPublicIP -P 22 -l user -L 8080:CentOSLocalIP:80 -N</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>-N</strong> permet d&#8217;ouvrir exclusivement le tunnel sans ouvrir la console.</p>
</div>
<div class="paragraph">
<p><strong>-L</strong> peuvent être multiple pour ajouter autant de port que vous souhaitez</p>
</div>
<div class="paragraph">
<p>Exemples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">rem HTTP
plink.exe -ssh proxmoxPublicIP -P 22 -l user -L 8080:CentOSLocalIP:80 -N</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">rem RDP Bureau distant Windows
plink.exe -ssh proxmoxPublicIP -P 22 -l user -L 33389:CentOSLocalIP:3389 -N</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilisation">Utilisation</h4>
<div class="paragraph">
<p>Ouvrons sur votre poste votre navigateur préféré à l&#8217;adresse suivante:
<strong><a href="http://localhost:8080" class="bare">http://localhost:8080</a></strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redirection_inverse_de_port">Redirection inverse de port</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_putty_2">Putty</h4>
<div class="paragraph">
<p>Dans ce cas, nous voulons avoir accès au port 80 de notre poste sur le serveur Windows 2003 avec IE8.
Nous pourrons alors tester notre site web avec IE8 par exemple.</p>
</div>
<div class="paragraph">
<p>Pour cela, nous devons créer un tunnel SSH. Nous allons utliser celui que nous avons précédemment configuré.</p>
</div>
<div class="paragraph">
<p>Configurons le tunnel dans SSH/Tunnels</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty4.png" alt="img"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Source Port : le port local au serveur Win 2003 sur lequel votre site web sera accessible

Destination: IP Locale de votre poste sur lequel le serveur web écoute

Remote: Permet de définir le sens de la redirection du port dans ce cas là  local -&gt; distant</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il faut sauvegarder la configuration.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty3.png" alt="img"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_ligne_de_commande_2">Ligne de commande</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">plink.exe -ssh proxmoxPublicIP -P 22 -l user -R *:1080:localhost:80 -N</code></pre>
</div>
</div>
<div class="paragraph">
<p>\*:1080 permet de préciser que ce port sera accessible pour toutes les interfaces réseaux.</p>
</div>
<div class="paragraph">
<p>-R peuvent être multiple pour ajouter autant de port que vous souhaitez.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_du_serveur_ssh">Configuration du serveur SSH</h4>
<div class="paragraph">
<p>Il faut préciser au serveur proxmox que le port redirigé sera accessible sur toutes les interfaces si le client le demande (<strong>*:1080</strong> de la ligne de commande)</p>
</div>
<div class="paragraph">
<p>Sur le serveur Proxmox,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sudo nano /etc/ssh/sshd_config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ajouter la ligne et sauvegarder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Match User `user`
   GatewayPorts yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Recharger la configuration du serveur SSH</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">/etc/init.d/ssh reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilisation_2">Utilisation</h4>
<div class="paragraph">
<p>Ouvrons sur le serveur Win 2003 avec IE8 l&#8217;adresse suivante:</p>
</div>
<div class="paragraph">
<p><strong><a href="http://IpLocaleServeurProxmox:8080" class="bare">http://IpLocaleServeurProxmox:8080</a></strong></p>
</div>
<div class="paragraph">
<p>Exemple:</p>
</div>
<div class="paragraph">
<p><strong><a href="http://192.168.0.254:8080" class="bare">http://192.168.0.254:8080</a></strong></p>
</div>
<div class="paragraph">
<p>Avec le bridge Proxmox configuré ainsi:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty5.png" alt="img"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_ressources">Ressources</h4>
<div class="paragraph">
<p><a href="http://askubuntu.com/questions/50064/reverse-port-tunnelling">Reverse Forwarding</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.cyberciti.biz/faq/howto-restart-ssh/">Reload SSH</a></p>
</div>
<div class="paragraph">
<p><a href="http://marc.terrier.free.fr/docputty/Chapter3.html==using-cmdline">Tutoriel Putty</a></p>
</div>
<div class="paragraph">
<p><a href="http://serverfault.com/questions/387772/ssh-reverse-port-forwarding-with-putty-how-to-specify-bind-address">Check Reverse Port Forwarding</a></p>
</div>
</div>
</div>
</div>
    </div>

    <div class="post related">

    </div>

    <footer class="post comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname = 'malysblog'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>

  </article>


        <footer>
          <span class="copyright">
            &copy; 2016. All rights reserved. Built with <a href="https://github.com/Kikobeats/uno-zen" target="_blank">Uno Zen</a> under <a href="http://hubpress.io/" target="_blank">HubPress</a>.
          </span>
        </footer>
      </section>
    </main>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
    <script src="//malys.github.io/themes/uno-zen/assets/js/uno-zen.js?v=1468781562223" type="text/javascript" charset="utf-8"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60775657-1', 'auto');
    ga('send', 'pageview');

    </script>
  </body>
</html>
