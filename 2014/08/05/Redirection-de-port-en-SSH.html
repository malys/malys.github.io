<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Redirection de port en SSH</title>
    <meta name="description" content="" />
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:300,400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="//malys.github.io/themes/saga/assets/css/style.css?v=1468781835049" rel="stylesheet" type="text/css">
    <link href="//malys.github.io/themes/saga/assets/css/animate.min.css?v=1468781835049" rel="stylesheet" type="text/css">
    <link href="https://malys.github.io/favicon.ico" rel="shortcut icon">
    <link rel="canonical" href="https://malys.github.io/2014/08/05/Redirection-de-port-en-SSH.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Des outils et des développeurs..." />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Redirection de port en SSH" />
    <meta property="og:description" content="Définition La redirection de port ou port forwarding ou port mapping en anglais, consiste à rediriger des paquets réseaux reçus sur un port donné d&amp;#8217;un ordinateur ou un équipement réseau vers un autre ordinateur ou équipement réseau sur un port donné. Cela permet entre autres de proposer à" />
    <meta property="og:url" content="https://malys.github.io/2014/08/05/Redirection-de-port-en-SSH.html" />
    <meta property="article:tag" content="SSH" />
    <meta property="article:tag" content="ProxMox" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Redirection de port en SSH" />
    <meta name="twitter:description" content="Définition La redirection de port ou port forwarding ou port mapping en anglais, consiste à rediriger des paquets réseaux reçus sur un port donné d&amp;#8217;un ordinateur ou un équipement réseau vers un autre ordinateur ou équipement réseau sur un port donné. Cela permet entre autres de proposer à" />
    <meta name="twitter:url" content="https://malys.github.io/2014/08/05/Redirection-de-port-en-SSH.html" />
    
    <script type="application/ld+json">
null
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Des outils et des développeurs..." href="https://malys.github.io/rss/" />
</head>
<body class="post-template tag-SSH tag-Prox-Mox">
    <header id="header" class="animated fadeIn">
    <div class="header-background">
    <section class="blog-content">
        <a id="site-url" class="blog-title" href="https://malys.github.io">Des outils et des développeurs...</a>
        <span class="blog-description">Astuces et conseils concernant les outils qui peuvent égailler le quotidien d&#x27;un développeur :)

</span>
        <nav class="links fadeIn animated">
            <ul>
                <!-- <li class="rss"><a title="RSS Feed" href="/rss/"><i class="fa fa-fw fa-rss-square"></i></a></li> -->
        
            </ul>
        </nav>
    </section>
    <section class="header-content">
        <h1 class="post-title animated fadeInUp">Redirection de port en SSH</h1>
        <span class="post-data"><span class="date animated fadeInUp"><i class="fa fa-clock-o"></i> <time class="timesince date" data-timesince="1407189600" datetime="2014-08-05T00:00" title="05 August 2014">2 years ago</time></span>
            <span class="tags animated fadeInUp"><i class="fa fa-tags"></i> <a href="https://malys.github.io/tag/SSH/">SSH</a>, <a href="https://malys.github.io/tag/Prox-Mox/">ProxMox</a></span>
            <span class="author animated fadeInUp"><i class="fa fa-user"></i> <a href="https://malys.github.io/author/malys/">Malys</a></span></span>
    </section>
    </div>
</header>
<main id="main" class="content">
    <article itemtype="http://schema.org/BlogPosting" class="animated fadeIn content post post tag-SSH tag-Prox-Mox">
        <section class="post-content">
            <div class="sect1">
<h2 id="_d_finition">Définition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La redirection de port ou port forwarding ou port mapping en anglais, consiste à rediriger des paquets réseaux reçus sur un port donné d&#8217;un ordinateur ou un équipement réseau vers un autre ordinateur ou équipement réseau sur un port donné. Cela permet entre autres de proposer à des ordinateurs extérieurs à un réseau d&#8217;accéder à des services répartis sur plusieurs ordinateurs de ce réseau. Voir <a href="http://fr.wikipedia.org/wiki/Redirection_de_port">Wikipedia</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_objectif">Objectif</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous souhaitons via une connexion SSH comsommer des services hébergées en local et des services locaux à distance</p>
</div>
<div class="paragraph">
<p>Dans notre cas, nous aurons un serveur Proxmox qui mettra à disposition des containers ou des machines virtuelles.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/portforwarding.png" alt="portforwarding.png"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redirection_de_port">Redirection de port</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_putty">Putty</h4>
<div class="paragraph">
<p>Dans ce cas, nous voulons avoir accès au port 80 de la VM sous CentOS avec le serveur web.</p>
</div>
<div class="paragraph">
<p>Pour cela, nous devons créer un tunnel SSH. Dans notre cas, nous utiliserons Putty comme client SSH (les commandes ssh sous Windows ou Linux sont quasiment identiques).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty1.png" alt="img"></span></p>
</div>
<div class="paragraph">
<p>et configurer le tunnel dans SSH/Tunnels</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty2.png" alt="img"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Source Port : le port local à votre poste sur lequel le service web distant sera accessible

Destination: IP Locale de la VM:Port à rediriger

Local: Permet de définir le sens de la redirection du port dans ce cas là distant -&gt; local</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il faut sauvegarder la configuration.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty3.png" alt="img"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_ligne_de_commande">Ligne de commande</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">plink.exe -ssh proxmoxPublicIP -P 22 -l user -L 8080:CentOSLocalIP:80 -N</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>-N</strong> permet d&#8217;ouvrir exclusivement le tunnel sans ouvrir la console.</p>
</div>
<div class="paragraph">
<p><strong>-L</strong> peuvent être multiple pour ajouter autant de port que vous souhaitez</p>
</div>
<div class="paragraph">
<p>Exemples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">rem HTTP
plink.exe -ssh proxmoxPublicIP -P 22 -l user -L 8080:CentOSLocalIP:80 -N</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">rem RDP Bureau distant Windows
plink.exe -ssh proxmoxPublicIP -P 22 -l user -L 33389:CentOSLocalIP:3389 -N</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilisation">Utilisation</h4>
<div class="paragraph">
<p>Ouvrons sur votre poste votre navigateur préféré à l&#8217;adresse suivante:
<strong><a href="http://localhost:8080" class="bare">http://localhost:8080</a></strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redirection_inverse_de_port">Redirection inverse de port</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_putty_2">Putty</h4>
<div class="paragraph">
<p>Dans ce cas, nous voulons avoir accès au port 80 de notre poste sur le serveur Windows 2003 avec IE8.
Nous pourrons alors tester notre site web avec IE8 par exemple.</p>
</div>
<div class="paragraph">
<p>Pour cela, nous devons créer un tunnel SSH. Nous allons utliser celui que nous avons précédemment configuré.</p>
</div>
<div class="paragraph">
<p>Configurons le tunnel dans SSH/Tunnels</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty4.png" alt="img"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Source Port : le port local au serveur Win 2003 sur lequel votre site web sera accessible

Destination: IP Locale de votre poste sur lequel le serveur web écoute

Remote: Permet de définir le sens de la redirection du port dans ce cas là  local -&gt; distant</code></pre>
</div>
</div>
<div class="paragraph">
<p>Il faut sauvegarder la configuration.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty3.png" alt="img"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_ligne_de_commande_2">Ligne de commande</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">plink.exe -ssh proxmoxPublicIP -P 22 -l user -R *:1080:localhost:80 -N</code></pre>
</div>
</div>
<div class="paragraph">
<p>\*:1080 permet de préciser que ce port sera accessible pour toutes les interfaces réseaux.</p>
</div>
<div class="paragraph">
<p>-R peuvent être multiple pour ajouter autant de port que vous souhaitez.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_du_serveur_ssh">Configuration du serveur SSH</h4>
<div class="paragraph">
<p>Il faut préciser au serveur proxmox que le port redirigé sera accessible sur toutes les interfaces si le client le demande (<strong>*:1080</strong> de la ligne de commande)</p>
</div>
<div class="paragraph">
<p>Sur le serveur Proxmox,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sudo nano /etc/ssh/sshd_config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ajouter la ligne et sauvegarder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Match User `user`
   GatewayPorts yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Recharger la configuration du serveur SSH</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">/etc/init.d/ssh reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilisation_2">Utilisation</h4>
<div class="paragraph">
<p>Ouvrons sur le serveur Win 2003 avec IE8 l&#8217;adresse suivante:</p>
</div>
<div class="paragraph">
<p><strong><a href="http://IpLocaleServeurProxmox:8080" class="bare">http://IpLocaleServeurProxmox:8080</a></strong></p>
</div>
<div class="paragraph">
<p>Exemple:</p>
</div>
<div class="paragraph">
<p><strong><a href="http://192.168.0.254:8080" class="bare">http://192.168.0.254:8080</a></strong></p>
</div>
<div class="paragraph">
<p>Avec le bridge Proxmox configuré ainsi:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://malys.github.io/images/Putty5.png" alt="img"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_ressources">Ressources</h4>
<div class="paragraph">
<p><a href="http://askubuntu.com/questions/50064/reverse-port-tunnelling">Reverse Forwarding</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.cyberciti.biz/faq/howto-restart-ssh/">Reload SSH</a></p>
</div>
<div class="paragraph">
<p><a href="http://marc.terrier.free.fr/docputty/Chapter3.html==using-cmdline">Tutoriel Putty</a></p>
</div>
<div class="paragraph">
<p><a href="http://serverfault.com/questions/387772/ssh-reverse-port-forwarding-with-putty-how-to-specify-bind-address">Check Reverse Port Forwarding</a></p>
</div>
</div>
</div>
</div>
        </section>

    
        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'malysblog'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>
    
    </article>

</main>
    <footer class="animated fadeIn" id="footer">
        <section class="colophon">
          <section class="copyright">Copyright &copy; <span itemprop="copyrightHolder">Des outils et des développeurs...</span>. <span rel="license">All Rights Reserved</span>.</section>
          <section class="poweredby">Published with <a class="icon-ghost" href="http://hubpress.io">HubPress</a></section>
        </section>
        <section class="bottom">
          <section class="attribution">
            <a href="http://github.com/Reedyn/Saga">Built with <i class="fa fa-heart"></i> and Free and Open-Source Software</a>.
          </section>
        </section>
    </footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
    <script src="//malys.github.io/themes/saga/assets/js/scripts.js?v=1468781835049"></script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60775657-1', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
